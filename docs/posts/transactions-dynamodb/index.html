<!DOCTYPE html>



<html lang="en" 
  
>

  <!--
  The Head
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  
    <meta name="pv-cache-enabled" content="false">

    
  

  <title>
      Transactions in DynamoDB | 
    Martyniuk Oleksandr
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://www.favicon-generator.org/
-->



<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon">
<link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon">

<link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png">
<link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png">
<link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png">

<link rel="icon" type="image/png" sizes="192x192"  href="/assets/img/favicons/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">

<link rel="manifest" href="/assets/img/favicons/manifest.json">
<meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'>
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">


  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous">
  <link rel="dns-prefetch" href="https://fonts.gstatic.com">

  <!-- GA -->
  

  <!-- jsDelivr CDN -->
  <link rel="preconnect" href="cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="cdn.jsdelivr.net">

  <!-- Bootstrap -->
  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
    integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous">

  <!-- Font Awesome -->
  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"
    integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ="
    crossorigin="anonymous">

  <!--
  CSS selector for site.
-->

<link rel="stylesheet" href="/assets/css/style.css">


  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css">



  <!-- JavaScripts -->

  <script src="/assets/js/dist/lang-detector.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>

  <script defer
    src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script>

  <!--
  JS selector for site.
-->


  





<script defer src="/assets/js/dist/post.min.js"></script>






</head>


  <body data-spy="scroll" data-target="#toc">

    <!--
  The Side Bar
-->



<div id="sidebar" class="d-flex flex-column align-items-end">

    <div class="profile-wrapper text-center">
        <div id="avatar">

            <a href="/" alt="avatar" class="mx-auto">
                
        
        <img src="/assets/img/sample/avatar.jpg" alt="avatar" onerror="this.style.display='none'">
      </a>
        </div>

        <div class="site-title mt-3">
            <a href="/">Martyniuk Oleksandr</a>
        </div>

        <div class="site-subtitle font-italic">.NET Engineer</div>

        <!-- language -->

        <div class="site-title mt-0">
            
            <a href="/uk/posts/transactions-dynamodb/" title="Українською">
                <img src="/assets/img/sample/ukrainian.png" width="40px" height="40px" />
            </a>
            
        </div>

    </div>
    <!-- .profile-wrapper -->

    <ul class="w-100">
        <!-- home -->
        
        <li class="nav-item">
            <a href="/" class="nav-link">
                <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
                <span>HOME</span>
            </a>
        </li>
        <!-- the real tabs -->
         

        <li class="nav-item">
            <a href="/categories/" class="nav-link">
                <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i>
                <span>CATEGORIES</span>
            </a>
        </li>
        <!-- .nav-item -->
         

        <li class="nav-item">
            <a href="/tags/" class="nav-link">
                <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i>
                <span>TAGS</span>
            </a>
        </li>
        <!-- .nav-item -->
         

        <li class="nav-item">
            <a href="/archives/" class="nav-link">
                <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
                <span>ARCHIVES</span>
            </a>
        </li>
        <!-- .nav-item -->
         

        <li class="nav-item">
            <a href="/projects/" class="nav-link">
                <i class="fa-fw fas fa-tasks ml-xl-3 mr-xl-3 unloaded"></i>
                <span>PROJECTS</span>
            </a>
        </li>
        <!-- .nav-item -->
         

        <li class="nav-item">
            <a href="/about/" class="nav-link">
                <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i>
                <span>ABOUT</span>
            </a>
        </li>
        <!-- .nav-item -->
        

    </ul>
    <!-- ul.nav.flex-column -->

    <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center">

          
        <a href="https://github.com/alexmartyniuk" aria-label="github" class="order-3"  target="_blank" rel="noopener" >
            <i class="fab fa-github-alt"></i>
        </a>
           
        <a href="https://twitter.com/alexmartyniuk" aria-label="twitter" class="order-4"  target="_blank" rel="noopener" >
            <i class="fab fa-twitter"></i>
        </a>
           
        <a href=" javascript:location.href = 'mailto:' + ['alexander.martinyuk','gmail.com'].join('@')" aria-label="email" class="order-5"  >
            <i class="fas fa-envelope"></i>
        </a>
           
        <a href="/feed.xml" aria-label="rss" class="order-6"  >
            <i class="fas fa-rss"></i>
        </a>
           
        <span class="icon-border order-2"></span> 

        <span id="mode-toggle-wrapper" class="order-1">
        <!--
  Switch the mode between dark and light.
-->

<i class="mode-toggle fas fa-adjust"></i>

<script type="text/javascript">

  class ModeToggle {
    static get MODE_KEY() { return "mode"; }
    static get DARK_MODE() { return "dark"; }
    static get LIGHT_MODE() { return "light"; }

    constructor() {
      if (this.hasMode) {
        if (this.isDarkMode) {
          if (!this.isSysDarkPrefer) {
            this.setDark();
          }
        } else {
          if (this.isSysDarkPrefer) {
            this.setLight();
          }
        }
      }

      var self = this;

      /* always follow the system prefers */
      this.sysDarkPrefers.addListener(function() {
        if (self.hasMode) {
          if (self.isDarkMode) {
            if (!self.isSysDarkPrefer) {
              self.setDark();
            }

          } else {
            if (self.isSysDarkPrefer) {
              self.setLight();
            }
          }

          self.clearMode();
        }

        self.updateMermaid();
      });

    } /* constructor() */


    setDark() {
      $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
    }

    setLight() {
      $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
    }

    clearMode() {
      $('html').removeAttr(ModeToggle.MODE_KEY);
      sessionStorage.removeItem(ModeToggle.MODE_KEY);
    }

    get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); }

    get isSysDarkPrefer() { return this.sysDarkPrefers.matches; }

    get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; }

    get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; }

    get hasMode() { return this.mode != null; }

    get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); }

    /* get the current mode on screen */
    get modeStatus() {
      if (this.isDarkMode
        || (!this.hasMode && this.isSysDarkPrefer) ) {
        return ModeToggle.DARK_MODE;
      } else {
        return ModeToggle.LIGHT_MODE;
      }
    }

    updateMermaid() {
      if (typeof mermaid !== "undefined") {
        let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default");
        let config = { theme: expectedTheme };

        /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */
        $(".mermaid").each(function() {
          let svgCode = $(this).prev().children().html();
          $(this).removeAttr("data-processed");
          $(this).html(svgCode);
        });

        mermaid.initialize(config);
        mermaid.init(undefined, ".mermaid");
      }
    }

    flipMode() {
      if (this.hasMode) {
        if (this.isSysDarkPrefer) {
          if (this.isLightMode) {
            this.clearMode();
          } else {
            this.setLight();
          }

        } else {
          if (this.isDarkMode) {
            this.clearMode();
          } else {
            this.setDark();
          }
        }

      } else {
        if (this.isSysDarkPrefer) {
          this.setLight();
        } else {
          this.setDark();
        }
      }

      this.updateMermaid();

    } /* flipMode() */

  } /* ModeToggle */

  let toggle = new ModeToggle();

  $(".mode-toggle").click(function() {

    toggle.flipMode();

  });

</script>

      </span> 

    </div>
    <!-- .sidebar-bottom -->

</div>
<!-- #sidebar -->

    <!--
  The Top Bar
-->

<div id="topbar-wrapper" class="row justify-content-center topbar-down">
  <div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between">
    <span id="breadcrumb">

    

    

      

        
          

        

      

        
        <span>
          
          
          <a href="/">
            Posts
          </a>
        </span>

        

      

        
          <span></span>

        

      

    

    </span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      Post
    </div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" placeholder="Search...">
      <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i>
    </span>
    <span id="search-cancel" >Cancel</span>
  </div>

</div>


    <div id="main-wrapper">
      <div id="main">

        <!--
  Refactor the HTML structure.
-->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->


<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->


<!-- Add attribute 'hide-bullet' to the checkbox list -->




  

  

  <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->
  
  

  

  



<!-- return -->
<div class="row">

  <div id="post-wrapper" class="col-12 col-lg-11 col-xl-8">

    <div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">

      <h1 data-toc-skip>Transactions in DynamoDB</h1>

      <div class="post-meta text-muted d-flex flex-column">
        <!-- Published date and author -->
        <div>
          <!--
  Date format snippet
-->





<span class="timeago "
  
    data-toggle="tooltip"
    data-placement="bottom"
    title="Tue, Sep 29, 2020, 12:00 AM +0300"
  >

  
  

  
    Sep 29, 2020
  

  <i class="unloaded">2020-09-29T00:00:00+03:00</i>

</span>
          
        </div>

        <div>       
          <!-- read time -->
          <!--
  Calculate the post's reading time, and display the word count in tooltip
 -->


<!-- words per minute  -->







<!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2524 words">14 min</span>


          <!-- page views -->
          

        </div>

      </div> <!-- .post-meta -->

      <div class="post-content">

        

        <h1 id="nosql-vs-sql">NoSQL vs. SQL</h1>

<p>For many years, relational databases dominated software development. SQL has become one of the most popular programming languages. But at the beginning of the 21st century, the WEB 2.0 and the needs of big companies such as Google and Facebook made a revolution in data storage.</p>

<p>Strict coherence and internal data aggregation have become less important than high availability, performance, and scalability. Over time, there has been a strong belief that NoSQL databases are for large data that needs to be stored in a cluster and retrieved quickly. Whereas SQL is for structured data that is related and must be strictly consistent through a transaction mechanism and foreign keys.</p>

<p>Before designing systems, programmers began to ask themselves: what is more important - <a href="https://uk.wikipedia.org/wiki/ACID">ACID</a> or high availability and speed? This situation lasted for some time until transactions appeared in NoSQL.</p>

<p>In this article, I will talk about transactions in one of the first NoSQL databases - Amazon DynamoDB. Let’s see how they differ from transactions in SQL, in which cases it is necessary to build programs with their use and how to work with them in C # and .NET Core.</p>

<h1 id="dynamodb">DynamoDB</h1>

<p><a href="https://aws.amazon.com/dynamodb/">DynamoDB</a> - schemaless document database. It stores data in tables, each of which can be hosted on multiple servers, thus distributing the load. This allows DynamoDB to process millions of requests per second during peak periods.</p>

<p>DynamoDB uses the JSON format to persist documents. Creating a table requires only three arguments: the table name, key, and attribute list, which must include the attribute used as the <em>partition key</em>.</p>

<p>The Partition Key is used to determine the actual location of the record. Applying the HASH function to the partition key, DynamoDB finds the physical server in the cluster and the location on the server where the data will be written. The partition key together with the optional Sort Key create the <em>primary key</em>, which allows you to uniquely identify the record in the DynamoDB table.</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/2020-09-28-use-dynamodb-transactions-with-dotnet-core/dynamodb-table-en.jpg" alt="" /></p>

<p>While relational databases offer a fairly powerful SQL language for queries, DynamoDB offers only <code class="language-plaintext highlighter-rouge">Put</code>,<code class="language-plaintext highlighter-rouge"> Get</code>, <code class="language-plaintext highlighter-rouge">Update</code> and<code class="language-plaintext highlighter-rouge"> Delete</code> operations on single tables and can’t combine tables at all. But because of this simplicity, DynamoDB is well scalable and has a high bandwidth.</p>

<p>Another feature of the database is that its use is charged not by the place occupied, but by the bandwidth measured by <code class="language-plaintext highlighter-rouge">RCU</code> and<code class="language-plaintext highlighter-rouge"> WCU</code>.</p>

<p><code class="language-plaintext highlighter-rouge">RCU</code> (read capacity unit) is a unit that corresponds to one read request up to 4 Kb of data. <code class="language-plaintext highlighter-rouge">WCU</code> (write capacity unit) - similar to read, only data limit - 1 Kb.</p>

<h1 id="local-dynamodb">Local DynamoDB</h1>
<p>Let’s try to run DynamoDB locally and execute simple queries to create a table and some records.</p>

<p>We need <a href="https://www.docker.com/">Docker</a> and <a href="https://dotnet.microsoft.com/download">.NET Core SDK</a> to work.</p>

<p>Amazon offers a local version of DynamoDB as a Docker image. It supports transactions, so we don’t need an AWS account. We will do everything on the local computer.</p>

<p>Open the console and run DynamoDB:</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="n">docker</span><span class="w"> </span><span class="nx">run</span><span class="w"> </span><span class="nt">-p</span><span class="w"> </span><span class="nx">8000:8000</span><span class="w"> </span><span class="nx">amazon/dynamodb-local</span><span class="w">

</span><span class="o">...</span><span class="w">
</span><span class="n">Initializing</span><span class="w"> </span><span class="nx">DynamoDB</span><span class="w"> </span><span class="nx">Local</span><span class="w"> </span><span class="nx">with</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">following</span><span class="w"> </span><span class="nx">configuration:</span><span class="w">
</span><span class="n">Port:</span><span class="w">           </span><span class="nx">8000</span><span class="w">
</span><span class="n">InMemory:</span><span class="w">       </span><span class="nx">true</span><span class="w">
</span><span class="n">DbPath:</span><span class="w">         </span><span class="nx">null</span><span class="w">
</span><span class="n">SharedDb:</span><span class="w">       </span><span class="nx">false</span><span class="w">
</span><span class="n">shouldDelayTransientStatuses:</span><span class="w">   </span><span class="nx">false</span><span class="w">
</span><span class="n">CorsParams:</span><span class="w">     </span><span class="o">*</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p>Docker loaded the <code class="language-plaintext highlighter-rouge">dynamodb-local</code> image and launched the service on port <code class="language-plaintext highlighter-rouge">8000</code>. Now we can access the database at <code class="language-plaintext highlighter-rouge">http://localhost:8000</code>.</p>

<p>The data will be stored in memory, as a result of <code class="language-plaintext highlighter-rouge">InMemory: true</code> parameter, so<code class="language-plaintext highlighter-rouge">DbPath</code> (the path to the data file) is empty. If you want to store data on disk between container launches you <a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/DynamoDBLocal.UsageNotes.html">need to specify parameters</a> <code class="language-plaintext highlighter-rouge">-sharedDB</code> and <code class="language-plaintext highlighter-rouge">-dbPath</code>.</p>

<h1 id="taxi-ordering-system">Taxi ordering system</h1>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/2020-09-28-use-dynamodb-transactions-with-dotnet-core/taxi-illustration.png" alt="" /></p>

<p>Before creating the first table, we will describe the domain that we will model.</p>

<p>Suppose we have a taxi ordering system. There is a customer, a driver, and an order. We will describe some requirements for our system.</p>

<ol>
  <li>When a customer orders a trip, an order is created.</li>
  <li>The driver of the car accepts the order to work.</li>
  <li>The driver cannot accept an order that is already taken.</li>
  <li>The driver cannot accept the order if he works on another order.</li>
</ol>

<p>This is a very simplified scheme of services such as Uber or Uklon. Of course, you can come up with much more requirements for such a system, but for us now they are not important. It is important for us to demonstrate <strong>idempotence</strong>, <strong>consistency</strong> and <strong>atomicity</strong> of DynamoDB operations.</p>

<p>So what tables do we need in the database?</p>

<p>The first is <em>client</em>. Any DynamoDB table must contain a unique key, lets it be the customer’s phone number. The table will also contain the current order of this customer.</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/2020-09-28-use-dynamodb-transactions-with-dotnet-core/client-table.png" alt="" /></p>

<p>The <em>driver</em> table is similar, but as a unique identifier we will use car number. Since the driver model is very similar to the customer model, why don’t we write them down in one table? Let’s call it <code class="language-plaintext highlighter-rouge">Taxi</code>.</p>

<p>The <em>order</em> will contain the driver, customer and order status: <code class="language-plaintext highlighter-rouge">Pending</code>,<code class="language-plaintext highlighter-rouge"> InProgress</code>, <code class="language-plaintext highlighter-rouge">Done</code>. We will also save the order in the <code class="language-plaintext highlighter-rouge">Taxi</code> table.</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/2020-09-28-use-dynamodb-transactions-with-dotnet-core/taxi-table.png" alt="" /></p>

<p>Imagine that there is a customer, driver, and order in a pending state.</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/2020-09-28-use-dynamodb-transactions-with-dotnet-core/taxi-table-1-en.jpg" alt="" /></p>

<p>For developers familiar with SQL, such a general table may seem strange. They immediately want to divide and normalize it. But in the world of NoSQL this is a completely normal thing. Such tables are called <em>homogeneous</em>. DynamoDB will not waste disk space to save empty record fields, because it saves documents as attribute collections. Amazon advises using homogeneous tables in DynamoDB. Their recommendation is <a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/bp-general-nosql-design.html#bp-general-nosql-design-concepts">keep related data as close as possible and have a minimum number of tables</a>.</p>

<h1 id="aws-sdk-and-net-core">AWS SDK and .NET Core</h1>
<p>Create a console program in .NET Core and add a package to work with DynamoDB API - <code class="language-plaintext highlighter-rouge">AWSSDK.DynamoDBv2</code></p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="n">dotnet</span><span class="w"> </span><span class="nx">new</span><span class="w"> </span><span class="nx">console</span><span class="w">

</span><span class="o">...</span><span class="w">
</span><span class="n">Restore</span><span class="w"> </span><span class="nx">succeeded.</span><span class="w">

</span><span class="n">dotnet</span><span class="w"> </span><span class="nx">add</span><span class="w"> </span><span class="nx">package</span><span class="w"> </span><span class="nx">AWSSDK.DynamoDBv2</span><span class="w">

</span><span class="n">info</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">PackageReference</span><span class="w"> </span><span class="nx">for</span><span class="w"> </span><span class="nx">package</span><span class="w"> </span><span class="s1">'AWSSDK.DynamoDBv2'</span><span class="w"> </span><span class="nx">version</span><span class="w"> </span><span class="s1">'3.5.0.22'</span><span class="w"> </span><span class="nx">added</span><span class="w"> </span><span class="o">...</span><span class="w">
</span><span class="o">...</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p>In the file <code class="language-plaintext highlighter-rouge">Program.cs</code> we will create the client for work with a local database and we will add a method for the creation of the table:</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre></td><td class="rouge-code"><pre><span class="k">private</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">AmazonDynamoDBClient</span> <span class="n">client</span> <span class="p">=</span>
    <span class="k">new</span> <span class="nf">AmazonDynamoDBClient</span><span class="p">(</span><span class="k">new</span> <span class="n">AmazonDynamoDBConfig</span> <span class="p">{</span><span class="n">ServiceURL</span> <span class="p">=</span> <span class="s">"http://localhost:8000"</span><span class="p">});</span>

<span class="k">private</span> <span class="k">const</span> <span class="kt">string</span> <span class="n">orderId</span> <span class="p">=</span> <span class="s">"{3e80b07d-e2e6-4310-8fda-851296a17a10}"</span><span class="p">;</span>
<span class="k">private</span> <span class="k">const</span> <span class="kt">string</span> <span class="n">driverId</span> <span class="p">=</span> <span class="s">"АК9265АК"</span><span class="p">;</span>
<span class="k">private</span> <span class="k">const</span> <span class="kt">string</span> <span class="n">clientId</span> <span class="p">=</span> <span class="s">"0993832478"</span><span class="p">;</span>
<span class="k">private</span> <span class="k">const</span> <span class="kt">string</span> <span class="n">tableName</span> <span class="p">=</span> <span class="s">"Taxi"</span><span class="p">;</span>

<span class="k">private</span> <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">CreateTable</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">CreateTableAsync</span><span class="p">(</span><span class="k">new</span> <span class="n">CreateTableRequest</span>
    <span class="p">{</span>
        <span class="n">TableName</span> <span class="p">=</span> <span class="n">tableName</span><span class="p">,</span>
        <span class="n">AttributeDefinitions</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">AttributeDefinition</span><span class="p">&gt;</span>
        <span class="p">{</span>
            <span class="k">new</span> <span class="n">AttributeDefinition</span>
            <span class="p">{</span>
                <span class="n">AttributeName</span> <span class="p">=</span> <span class="s">"Id"</span><span class="p">,</span>
                <span class="n">AttributeType</span> <span class="p">=</span> <span class="s">"S"</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="n">KeySchema</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">KeySchemaElement</span><span class="p">&gt;</span>
        <span class="p">{</span>
            <span class="k">new</span> <span class="n">KeySchemaElement</span>
            <span class="p">{</span>
                <span class="n">AttributeName</span> <span class="p">=</span> <span class="s">"Id"</span><span class="p">,</span>
                <span class="n">KeyType</span> <span class="p">=</span> <span class="s">"HASH"</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="n">ProvisionedThroughput</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ProvisionedThroughput</span>
        <span class="p">{</span>
            <span class="n">ReadCapacityUnits</span> <span class="p">=</span> <span class="m">5</span><span class="p">,</span>
            <span class="n">WriteCapacityUnits</span> <span class="p">=</span> <span class="m">5</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>
<blockquote>
  <p>The code can be found at <a href="https://github.com/alexmartyniuk/blog-dynamodb-transactions/">Github</a></p>
</blockquote>

<p>The only attribute we defined is <code class="language-plaintext highlighter-rouge">Id</code> of type<code class="language-plaintext highlighter-rouge"> String</code>. The diagram indicates that the <code class="language-plaintext highlighter-rouge">Id</code> field will be the section key. You also need to specify the expected bandwidth so that DynamoDB knows how to scale properly. For us it is not important, let it be 5 units per second for reading and writing.</p>

<p>We will add the customer, driver and order as shown in the table above. We use the non-transactional method <code class="language-plaintext highlighter-rouge">PutItem</code>.</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre></td><td class="rouge-code"><pre><span class="k">private</span> <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">AddClientDriverAndOrder</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">PutItemAsync</span><span class="p">(</span><span class="k">new</span> <span class="n">PutItemRequest</span>
    <span class="p">{</span>
        <span class="n">TableName</span> <span class="p">=</span> <span class="n">tableName</span><span class="p">,</span>
        <span class="n">Item</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">AttributeValue</span><span class="p">&gt;()</span>
        <span class="p">{</span>
            <span class="p">{</span> <span class="s">"Id"</span><span class="p">,</span> <span class="k">new</span> <span class="n">AttributeValue</span> <span class="p">{</span> <span class="n">S</span> <span class="p">=</span> <span class="n">clientId</span> <span class="p">}},</span>
            <span class="p">{</span> <span class="s">"OrderId"</span><span class="p">,</span> <span class="k">new</span> <span class="n">AttributeValue</span> <span class="p">{</span> <span class="n">S</span> <span class="p">=</span> <span class="n">orderId</span> <span class="p">}}</span>
        <span class="p">}</span>
    <span class="p">});</span>

    <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">PutItemAsync</span><span class="p">(</span><span class="k">new</span> <span class="n">PutItemRequest</span>
    <span class="p">{</span>
        <span class="n">TableName</span> <span class="p">=</span> <span class="n">tableName</span><span class="p">,</span>
        <span class="n">Item</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">AttributeValue</span><span class="p">&gt;()</span>
        <span class="p">{</span>
            <span class="p">{</span> <span class="s">"Id"</span><span class="p">,</span> <span class="k">new</span> <span class="n">AttributeValue</span> <span class="p">{</span> <span class="n">S</span> <span class="p">=</span> <span class="n">driverId</span> <span class="p">}}</span>
        <span class="p">}</span>
    <span class="p">});</span>

    <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">PutItemAsync</span><span class="p">(</span><span class="k">new</span> <span class="n">PutItemRequest</span>
    <span class="p">{</span>
        <span class="n">TableName</span> <span class="p">=</span> <span class="n">tableName</span><span class="p">,</span>
        <span class="n">Item</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">AttributeValue</span><span class="p">&gt;()</span>
        <span class="p">{</span>
            <span class="p">{</span> <span class="s">"Id"</span><span class="p">,</span> <span class="k">new</span> <span class="n">AttributeValue</span> <span class="p">{</span> <span class="n">S</span> <span class="p">=</span> <span class="n">orderId</span> <span class="p">}},</span>
            <span class="p">{</span> <span class="s">"ClientId"</span><span class="p">,</span> <span class="k">new</span> <span class="n">AttributeValue</span> <span class="p">{</span> <span class="n">S</span> <span class="p">=</span> <span class="n">clientId</span> <span class="p">}},</span>
            <span class="p">{</span> <span class="s">"OrderStatus"</span><span class="p">,</span> <span class="k">new</span> <span class="n">AttributeValue</span> <span class="p">{</span><span class="n">S</span> <span class="p">=</span> <span class="s">"Pending"</span><span class="p">}}</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<h1 id="transaction-in-action">Transaction in action</h1>
<p>Let’s try to implement a more complex operation, for example, <em>the driver takes the order to work</em>. For this we need:</p>
<ul>
  <li>update order line:
    <ul>
      <li>write the number of the driver’s car in the field <code class="language-plaintext highlighter-rouge">DriverId</code>, if it is empty (the driver can not take the order, which is already being executed)</li>
      <li>write <code class="language-plaintext highlighter-rouge">InProgress</code> in the field <code class="language-plaintext highlighter-rouge">OrderStatus</code>, if it was <code class="language-plaintext highlighter-rouge">Pending</code> (the driver can not take the order in any status other than <code class="language-plaintext highlighter-rouge">Pending</code>)</li>
    </ul>
  </li>
  <li>update driver line:
    <ul>
      <li>write the order number in the field <code class="language-plaintext highlighter-rouge">OrderId</code>, if it is empty (the driver can not take two orders at once)</li>
    </ul>
  </li>
</ul>

<p>That is, the final result should look like this:</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/2020-09-28-use-dynamodb-transactions-with-dotnet-core/taxi-table-2-en.jpg" alt="" /></p>

<p>Here we need a <a href="https://uk.wikipedia.org/wiki/ACID">ACID</a> transaction because we need to update the order record and the driver record at the same time. If any of the above conditions are not met, no changes to the database should occur.</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
</pre></td><td class="rouge-code"><pre><span class="k">private</span> <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">await</span> <span class="nf">CreateTable</span><span class="p">();</span>
    <span class="k">await</span> <span class="nf">AddClientDriverAndOrder</span><span class="p">();</span>
    <span class="k">await</span> <span class="nf">AssignOrderToDriver</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">static</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">AssignOrderToDriver</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">TransactWriteItemsAsync</span><span class="p">(</span><span class="k">new</span> <span class="n">TransactWriteItemsRequest</span>
    <span class="p">{</span>
        <span class="n">TransactItems</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">TransactWriteItem</span><span class="p">&gt;</span>
        <span class="p">{</span>
            <span class="k">new</span> <span class="n">TransactWriteItem</span>
            <span class="p">{</span>
                <span class="n">Update</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Update</span>
                <span class="p">{</span>
                    <span class="n">TableName</span> <span class="p">=</span> <span class="n">tableName</span><span class="p">,</span>
                    <span class="n">Key</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">AttributeValue</span><span class="p">&gt;</span>
                    <span class="p">{</span>
                        <span class="p">{</span> <span class="s">"Id"</span><span class="p">,</span> <span class="k">new</span> <span class="n">AttributeValue</span> <span class="p">{</span> <span class="n">S</span> <span class="p">=</span> <span class="n">driverId</span> <span class="p">}}</span>
                    <span class="p">},</span>
                    <span class="n">UpdateExpression</span> <span class="p">=</span> <span class="s">"set OrderId = :OrderId"</span><span class="p">,</span>
                    <span class="n">ConditionExpression</span> <span class="p">=</span> <span class="s">"attribute_not_exists(OrderId)"</span><span class="p">,</span>
                    <span class="n">ExpressionAttributeValues</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">AttributeValue</span><span class="p">&gt;()</span>
                    <span class="p">{</span>
                        <span class="p">{</span><span class="s">":OrderId"</span><span class="p">,</span> <span class="k">new</span> <span class="n">AttributeValue</span> <span class="p">{</span> <span class="n">S</span> <span class="p">=</span> <span class="n">orderId</span><span class="p">}}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="k">new</span> <span class="n">TransactWriteItem</span>
            <span class="p">{</span>
                <span class="n">Update</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Update</span>
                <span class="p">{</span>
                    <span class="n">TableName</span> <span class="p">=</span> <span class="n">tableName</span><span class="p">,</span>
                    <span class="n">Key</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">AttributeValue</span><span class="p">&gt;</span>
                    <span class="p">{</span>
                        <span class="p">{</span> <span class="s">"Id"</span><span class="p">,</span> <span class="k">new</span> <span class="n">AttributeValue</span> <span class="p">{</span> <span class="n">S</span> <span class="p">=</span> <span class="n">orderId</span> <span class="p">}}</span>
                    <span class="p">},</span>
                    <span class="n">UpdateExpression</span> <span class="p">=</span> <span class="s">"set DriverId = :DriverId, OrderStatus = :NewStatus"</span><span class="p">,</span>
                    <span class="n">ConditionExpression</span> <span class="p">=</span> <span class="s">"attribute_not_exists(DriverId) AND OrderStatus=:OldStatus"</span><span class="p">,</span>
                    <span class="n">ExpressionAttributeValues</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">AttributeValue</span><span class="p">&gt;()</span>
                    <span class="p">{</span>
                        <span class="p">{</span><span class="s">":DriverId"</span><span class="p">,</span> <span class="k">new</span> <span class="n">AttributeValue</span> <span class="p">{</span> <span class="n">S</span> <span class="p">=</span> <span class="n">driverId</span><span class="p">}},</span>
                        <span class="p">{</span><span class="s">":OldStatus"</span><span class="p">,</span> <span class="k">new</span> <span class="n">AttributeValue</span> <span class="p">{</span> <span class="n">S</span> <span class="p">=</span> <span class="s">"Pending"</span><span class="p">}},</span>
                        <span class="p">{</span><span class="s">":NewStatus"</span><span class="p">,</span> <span class="k">new</span> <span class="n">AttributeValue</span> <span class="p">{</span> <span class="n">S</span> <span class="p">=</span> <span class="s">"InProgress"</span><span class="p">}}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="n">ClientRequestToken</span> <span class="p">=</span> <span class="s">"IdempotencyToken"</span><span class="p">,</span>
        
    <span class="p">});</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>In this code, we execute a transaction consisting of two elements <code class="language-plaintext highlighter-rouge">TransactWriteItem</code>. If the condition in <code class="language-plaintext highlighter-rouge">ConditionExpression</code> is met, the expression <code class="language-plaintext highlighter-rouge">UpdateExpression</code> will be executed.</p>

<p>To change the driver, we update the order number if it is empty:</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>    <span class="n">UpdateExpression</span> <span class="p">=</span> <span class="s">"set OrderId =: OrderId"</span><span class="p">,</span>
    <span class="n">ConditionExpression</span> <span class="p">=</span> <span class="s">"Attribute_not_exists (OrderId)"</span><span class="p">,</span>
</pre></td></tr></tbody></table></code></div></div>

<p>To change the order, we update the driver field and status if the driver has not yet been assigned and the status is <code class="language-plaintext highlighter-rouge">Pending</code>:</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>    <span class="n">UpdateExpression</span> <span class="p">=</span> <span class="s">"set DriverId =: DriverId, OrderStatus =: NewStatus"</span><span class="p">,</span>
    <span class="n">ConditionExpression</span> <span class="p">=</span> <span class="s">"attribute_not_exists (DriverId) AND OrderStatus =: OldStatus"</span><span class="p">,</span>
</pre></td></tr></tbody></table></code></div></div>

<p>This operation allows the driver to take the order and meets our three requirements:</p>
<ul>
  <li>It is <strong>idempotent</strong>. Repeating the call will not change the state of the database and will not cause an error. This is due to the <code class="language-plaintext highlighter-rouge">ClientRequestToken</code> attribute, which is essentially an idempotency token. All subsequent queries to the database with the same <code class="language-plaintext highlighter-rouge">ClientRequestToken</code> will be ignored. This allows, for example, the driver to mistakenly press the order acceptance button twice.</li>
  <li>It is <strong>consistent</strong>. Order and driver records change synchronously so that the driver cannot take an order in a status other than <code class="language-plaintext highlighter-rouge">Pending</code>. An order in <code class="language-plaintext highlighter-rouge">Pending</code> status will always have a linked driver.</li>
  <li>It is <strong>atomic</strong>. The query will either be executed as a whole or no changes will be applied to the database.</li>
</ul>

<h1 id="reasons-for-transaction-failure">Reasons for transaction failure</h1>
<p>If you perform this method but with incorrect data (for example, the driver tries to take someone else’s order), it will cause an error:</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="n">Amazon</span><span class="p">.</span><span class="n">DynamoDBv2</span><span class="p">.</span><span class="n">Model</span><span class="p">.</span><span class="n">TransactionCanceledException</span><span class="p">:</span>
<span class="err">'</span><span class="n">Transaction</span> <span class="n">canceled</span><span class="p">,</span> <span class="n">please</span> <span class="n">refer</span> <span class="n">cancellation</span> <span class="n">reasons</span> <span class="k">for</span> <span class="n">specific</span> <span class="n">reasons</span> <span class="p">...</span><span class="err">'</span>
</pre></td></tr></tbody></table></code></div></div>

<p>The transaction can be canceled for several reasons:</p>
<ul>
  <li>the condition in <code class="language-plaintext highlighter-rouge">ConditionExpression</code> is not fulfilled</li>
  <li>another transaction with the same record is executed at the same time</li>
  <li>insufficient bandwidth (in our case it is more than 5 calls per second)</li>
  <li>not enough permissions to execute the request (this only applies to DynamoDB in AWS)</li>
</ul>

<p>What to do when you get a transaction error? You should try the operation again. Make sure you have set the idempotency token (field <code class="language-plaintext highlighter-rouge">ClientRequestToken</code>), then the SDK can try to retry the request.</p>

<p>If your transaction fails after automatic attempts, you must retry at the application logic level. To do this, you need to rebuild the original state of your program and try to repeat the transaction with new conditions and a new desired state of the database.</p>

<p>To get a new initial state of your program (database synchronization), you can choose one of three methods:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">ReturnValuesOnConditionCheckFailure = ReturnValuesOnConditionCheckFailure.ALL_OLD</code> - setting this field allows you to return attribute values ​​when executing a transaction if the transaction condition was not met.</li>
  <li>Execute <code class="language-plaintext highlighter-rouge">TransactionGetItems</code>, ie transactionally obtain all necessary data yourself.</li>
  <li>Continue working and expect eventually consistency will be achieved, maybe after a second request.</li>
</ul>

<h1 id="comparison-with-sql">Comparison with SQL</h1>
<p>In SQL and some other NoSQL solutions, such as MongoDB, transactions are implemented in a conversational style. The first call opens the transaction (<code class="language-plaintext highlighter-rouge">BEGIN TRANSACTION</code>), then the individual calls modify the data (<code class="language-plaintext highlighter-rouge">INSERT</code>, <code class="language-plaintext highlighter-rouge">UPDATE</code>,<code class="language-plaintext highlighter-rouge"> DELETE</code>). At the end, the transaction is closed (<code class="language-plaintext highlighter-rouge">COMMIT TRANSACTION</code>).</p>

<p>This distribution of coordination between the client and the server imposes some restrictions on transactions and makes their implementation more difficult and makes execution slower.</p>

<p>DynamoDB transactions are implemented within <em>a single API call</em>.</p>

<p>DynamoDB transactions run only on the server and the client has no control over the start of the transaction, its commit, or rollback. This makes DynamoDB transactions very fast and the developer does not need to choose between a transactional database and a database that scales horizontally.</p>

<p>Also, with DynamoDB transactions, mutual locking is not possible because optimistic concurrency control is used. This ensures low latency and high availability.</p>

<h1 id="disadvantages-of-transactions">Disadvantages of transactions</h1>
<p>But DynamoDB transactions have a number of limitations to consider:</p>
<ul>
  <li>Transactions only work within one region and one AWS account.</li>
  <li>Transactions can contain up to ten items, ie you can update or add up to 10 records at a time.</li>
  <li>Transactions consume twice as much <code class="language-plaintext highlighter-rouge">RCU</code> or<code class="language-plaintext highlighter-rouge"> WCU</code>, as a two-phase mechanism is used inside: after the transaction, the data is read again to confirm their correctness. Because of this, transactional calls will be twice as expensive for the consumer.</li>
</ul>

<h1 id="conclusion">Conclusion</h1>
<p>Transactions in DynamoDB help developers:</p>
<ul>
  <li>maintain the correctness of the data by making changes to several records and tables simultaneously;</li>
  <li>simplify the business logic of programs by transferring data validation to the server;</li>
  <li>update data in many tables consistently.</li>
</ul>

<p>DynamoDB transactions fully support ACID and at the same time can be scaled indefinitely to ensure low latency and high data availability.</p>

<p>For .NET developers, Amazon offers a low-level SDK for accessing DynamoDB that fully supports transactions. Its use is a little bit wordy and can confuse a beginner, but if you plan to work with heavy database loads and at the same time do not want to deprive yourself of ACID transactions, DynamoDB may be a good choice.</p>

<blockquote>
  <p>All code examples can be found at <a href="https://github.com/alexmartyniuk/blog-dynamodb-transactions/">Github</a></p>
</blockquote>


      </div>

      <div class="post-tail-wrapper text-muted">

        <!-- categories -->
        
        <div class="post-meta mb-3">
          <i class="far fa-folder-open fa-fw mr-1"></i>
          
            <a href='/categories/programming/'>Programming</a>,
            <a href='/categories/net/'>.NET</a>
        </div>
        

        <!-- tags -->
        

        <div class="post-tail-bottom
          d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
          

          

        </div><!-- .post-tail-bottom -->

      </div><!-- div.post-tail -->

    </div> <!-- .post -->


  </div> <!-- #post-wrapper -->

  

  

  <!--
  The Pannel on right side (Desktop views)
-->

<div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down">

  <div class="access">

  















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  

  
    <div id="access-tags">
      <span>Trending Tags</span>
      <div class="d-flex flex-wrap mt-3 mb-1 mr-3">        
      
        
        <a class="post-tag" href="/tags/c/">C#</a>
      
        
        <a class="post-tag" href="/tags/net/">.NET</a>
      
        
        <a class="post-tag" href="/tags/acid/">ACID</a>
      
        
        <a class="post-tag" href="/tags/algorithms/">algorithms</a>
      
        
        <a class="post-tag" href="/tags/aws/">AWS</a>
      
        
        <a class="post-tag" href="/tags/codility-com/">codility.com</a>
      
        
        <a class="post-tag" href="/tags/dynamodb/">DynamoDB</a>
      
        
        <a class="post-tag" href="/tags/experience/">experience</a>
      
        
        <a class="post-tag" href="/tags/integration-tests/">integration tests</a>
      
        
        <a class="post-tag" href="/tags/linq/">LINQ</a>
      

      </div>
    </div>
  
  </div> <!-- .access -->

  

</div> <!-- #panel-wrapper -->


</div> <!-- .row -->

<div class="row">
  <div class="col-12 col-lg-11 col-xl-8">
    <div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">

          

    

    
      <!--
  The Disqus lazy loading.
  Powered by: <https://github.com/osvaldasvalutis/disqusLoader.js>
-->

<div id="disqus" class="pt-2 pb-2">
  <p class="text-center text-muted small pb-5">
    Loading comments from <a href="https://disqus.com/">Disqus</a> ...
  </p>
</div>

<script src="/assets/js/lib/jquery.disqusloader.min.js"></script>
<script>
  const options = {
    scriptUrl: '//martyniuk.disqus.com/embed.js',

    disqusConfig: function() {
      this.page.title = '';
      this.page.url = 'http://0.0.0.0:4000/posts/transactions-dynamodb/';
      this.page.identifier = '/posts/transactions-dynamodb/';
    }
  };

  $.disqusLoader('#disqus', options);
</script>

    

    </div> <!-- #post-extend-wrapper -->

  </div> <!-- .col-* -->

</div> <!-- .row -->



  <!--
  image lazy load: https://github.com/ApoorvSaxena/lozad.js
-->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script>

<script type="text/javascript">
  const imgs = document.querySelectorAll('.post-content img');
  const observer = lozad(imgs);
  observer.observe();
</script>




        <!--
  The Footer
-->

<footer class="d-flex w-100 justify-content-center">
  <div class="d-flex justify-content-between align-items-center">
    

    <div class="footer-left">

    </div>

    <div class="footer-right">
      <p class="mb-0">
        Powered by
        <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>
        with
        <a href="https://github.com/cotes2020/jekyll-theme-chirpy"
          target="_blank" rel="noopener">Chirpy</a>
        theme.
      </p>
    </div>

  </div> <!-- div.d-flex -->
</footer>


      </div>

      <!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-hints">
      <h4 class="text-muted mb-4">Trending Tags</h4>

      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



      
        
        <a class="post-tag" href="/tags/c/">C#</a>
      
        
        <a class="post-tag" href="/tags/net/">.NET</a>
      
        
        <a class="post-tag" href="/tags/acid/">ACID</a>
      
        
        <a class="post-tag" href="/tags/algorithms/">algorithms</a>
      
        
        <a class="post-tag" href="/tags/aws/">AWS</a>
      
        
        <a class="post-tag" href="/tags/codility-com/">codility.com</a>
      
        
        <a class="post-tag" href="/tags/dynamodb/">DynamoDB</a>
      
        
        <a class="post-tag" href="/tags/experience/">experience</a>
      
        
        <a class="post-tag" href="/tags/integration-tests/">integration tests</a>
      
        
        <a class="post-tag" href="/tags/linq/">LINQ</a>
      

    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>


    </div> <!-- #main-wrapper -->

    

    <div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="http://0.0.0.0:4000{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No result founds.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }

    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>


  </body>

</html>

